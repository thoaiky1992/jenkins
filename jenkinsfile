pipeline {
    agent any

    environment {
        DOCKER_HUB_CREDENTIALS_USER = ""
        DOCKER_HUB_CREDENTIALS_PASSWORD = ""
    }

    stages {
        stage('Checkout') {
            steps {
                script {
                    // Use SSH agent to manage the SSH key
                     checkout([
                        $class: 'GitSCM',
                        branches: [[name: '*/master']],
                        doGenerateSubmoduleConfigurations: false,
                        extensions: [],
                        submoduleCfg: [],
                        userRemoteConfigs: [[url: 'git@github.com:thoaiky1992/jenkins.git', credentialsId: 'ssh-key-id']]
                    ])
                }
            }
        }
        stage('Build Docker Image') {
            steps {
                script {
                    // Build Docker image
                    sh 'docker build -t thoaiky1992/jenkins-api:${TAG_VERSION} .'
                }
            }
        }
        stage('Push Docker Image') {
            steps {
                script {
                    // Login to Docker Hub and push Docker image
                    sh 'echo ${DOCKER_HUB_CREDENTIALS_PASSWORD} | docker login -u ${DOCKER_HUB_CREDENTIALS_USER} --password-stdin'
                    sh 'docker push thoaiky1992/jenkins-api:${TAG_VERSION}'
                }
            }
        }
    }
}